# Setup with Consul
1. Consul must be configured with [ACL](https://github.com/C256k145/consul/blob/master/acl.md) enabled, and [TLS](https://learn.hashicorp.com/consul/security-networking/certificates) configured. I found [this](https://learn.hashicorp.com/vault/operations/ops-deployment-guide) guide to be helpful(honestly this wiki is pretty much just a simplified version of that link)
2. Set up vault as a service([docs for your convenience](https://www.vaultproject.io/docs)). For this setup I had every node running a vault server(for future High Availability setup). I had the most success with *very* minimal .service file. This service needs to be running on every server, but not every client

    Sample /etc/systemd/system/vault.service file
    ```
    [Unit]
    Description="HashiCorp Vault - A tool for managing secrets"
    After=network-online.target

    [Service]
    Type=simple
    ExecStart=/usr/local/bin/vault server -config=/etc/vault.d/vault.hcl

    [Install]
    WantedBy=multi-user.target
    ```
    I used [this](https://github.com/C256k145/consul/blob/master/vault_install.sh) script to install vault, it shouldnt be necessary but it cant hurt to include. 
3. For minimal setup, create the "listener" and "storage" stanzas in the *.hcl config file

    Sample /etc/vault.d/vault.hcl file
    ```HCL
    listener "tcp" {
    address       = "0.0.0.0:8200"
    tls_cert_file = "/path/to/pub_TLS_key.pem"
    tls_key_file  = "/path/to/priv_TLS_key.pem"
    }

    storage "consul" {
    address = "<consul_cluster_address>:8500"
    path = "vault/"
    token = "<token here>"
    }

    api_addr="<address to vault api>"
    ui = true
    ```
4. Once the service is running, you can initialize the vault keys with 
    ```Bash
    vault operator init
    ```
    This will generate and display an initial root token, and by default, 5 unseal keys, with 3 required to unseal the vault. Furthermore, this command is extremely configurable, the [documentation](https://www.vaultproject.io/docs/commands/operator/init) has extensive details on what can be done with this
5. Hashicorp is a big fan of storing keys/certs in environment variables instead of hardcoding them in config files(though im sure they *can* be put in config files, hopefully ill fill in more details later)
    ```Bash
    export VAULT_CACERT=/path/to/pub_cacert.pem
    export VAULT_TOKEN=<token>
    ```
    The \<token\> above is intended to be the root token generated by command from #4. More helpful env variables are shown at the bottom of [this](https://www.vaultproject.io/docs/commands) page
6.  Next, I will most likely set up 1 server with various clients to work with distributing and managing the keys/secrets themselves. testing